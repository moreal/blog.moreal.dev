<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="shortcut icon" href="logo.svg"><title>í˜íƒ€ë°”ì´íŠ¸ íŠ¸ë˜í”½ ì›ì¸ ë¶„ì„ê¸° | </title>
  <meta name="title" content="í˜íƒ€ë°”ì´íŠ¸ íŠ¸ë˜í”½ ì›ì¸ ë¶„ì„ê¸°">
<meta name="description" content="">
<meta name="referrer" content="strict-origin-when-cross-origin">
  <style>
    :root {
    --width: 800px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color: #8b6fcb;
    --code-background-color: #f2f2f2;
    --code-color: #222;
    --blockquote-color: #222;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --background-color: #01242e;
      --heading-color: #eee;
      --text-color: #ddd;
      --link-color: #8cc2dd;
      --visited-color: #8b6fcb;
      --code-background-color: #000;
      --code-color: #ddd;
      --blockquote-color: #ccc;
    }
  }

  body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
  }

  a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  nav a {
    margin-right: 8px;
  }

  nav span.active {
    font-weight: bold;
    margin-right: 10px;
  }
  strong,
  b {
    color: var(--heading-color);
  }

  button {
    margin: 0;
    cursor: pointer;
  }

  main {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  hr {
    border: 0;
    border-top: 1px dashed;
  }

  img {
    max-width: 100%;
  }

  pre code {
    background-color: var(--code-background-color);
    color: var(--code-color);
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 0.875rem;
    overflow-x: auto;
  }

  code {
    font-family: monospace;
    padding: 2px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
  }

  blockquote {
    border-left: 1px solid #999;
    color: var(--code-color);
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px 0;
    text-align: center;
  }

  .title:hover {
    text-decoration: none;
  }

  .title h1 {
    font-size: 1.5em;
  }

  .inline {
    width: auto !important;
  }

  .highlight,
  .code {
    padding: 1px 15px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
  }

  /* blog post list */
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: var(--visited-color);
  }

  .tags {
    font-size: smaller;
  }

  </style><style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap');
@import url('https://unpkg.com/@catppuccin/palette/css/catppuccin.css');

main {
  /* font-family: "Noto Serif CJK KR", "Noto Serif KR", serif; */
  font-optical-sizing: auto;
  font-style: sans-serif;
  font-feature-settings: "chws", "halt"
}
</style>

</head>
<body>
  <header>
  <a href="https://moreal.dev/" class="title">
    <h1></h1>
  </a>
  <nav aria-label="moreal dev">
      <a href="https://moreal.dev/">home</a>
      <a href="https://moreal.dev/blog/">blog</a>
      <a href="https:&#x2F;&#x2F;resume.moreal.dev&#x2F;">resume</a>
  </nav>
</header>
<h1>í˜íƒ€ë°”ì´íŠ¸ íŠ¸ë˜í”½ ì›ì¸ ë¶„ì„ê¸°</h1>
      <p>
        <i>
          <time datetime="2023-03-15T00:00:00+00:00" pubdate>15 Mar, 2023</time>
        </i>
      </p>
  <main>
    <h2 id="daesibodeue-boineun-isanghan-danwi">ëŒ€ì‹œë³´ë“œì— ë³´ì´ëŠ” ì´ìƒí•œ ë‹¨ìœ„</h2>
<p>íšŒì‚¬ì—ì„œëŠ” ìš´ì˜í•˜ëŠ” ì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì£¼ì˜ ì‚¬í•­ì„ ê³µìœ í•˜ê¸° ìœ„í•œ ì£¼ê°„ ë¯¸íŒ…ì„ ì§„í–‰í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ëŠ” EKSë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, ìƒíƒœ í™•ì¸ì„ ìœ„í•´ AWS CloudWatch Container Insightsë¥¼ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì–´ëŠ ë‚  ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•˜ë‹¤ ì´ìƒí•œ ìˆ˜ì¹˜ë“¤ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>
<p><img src="https://moreal.dev/blog/petabyte-traffic/./container-insight-network-rx.png" alt="" /></p>
<p>Yì¶•ì˜ ë‹¨ìœ„ë¥¼ ë³´ë‹ˆ 1.67 í˜íƒ€ë°”ì´íŠ¸ê°€ í‘œì‹œë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<p><img src="https://moreal.dev/blog/petabyte-traffic/./container-insight-petabyte-traffic.png" alt="" /></p>
<p>ìµœëŒ€ ê°’ì€ 400 í˜íƒ€ë°”ì´íŠ¸ì— ì´ë¥´ë €ìŠµë‹ˆë‹¤. ğŸ™€</p>
<p>ì—¬ëŸ¬ ê°€ì§€ ì¶”ì¸¡ì„ í•´ë´¤ì§€ë§Œ, ì›ì¸ì„ ì°¾ê¸° ìœ„í•´ CloudWatchê°€ ì–´ë–»ê²Œ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ëŠ”ì§€ ì•Œì•„ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>
<h2 id="cloudwatchga-meteurigeul-sujibhaneun-bangbeob">CloudWatchê°€ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•</h2>
<p>CloudWatch ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë°©ë²•ì„ ì•Œì•„ë³´ê¸° ìœ„í•´, ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê³µê°œëœ <a href="https://github.com/aws/amazon-cloudwatch-agent">aws/amazon-cloudwatch-agent</a> ì €ì¥ì†Œë¥¼ ì°¸ì¡°í–ˆìŠµë‹ˆë‹¤.</p>
<p><code>amazon-cloudwatch-agent</code>ëŠ” Kubernetesì—ì„œ ì‚¬ìš©í•˜ëŠ” cAdvisorë¥¼ í™œìš©í•©ë‹ˆë‹¤. cAdvisorëŠ” ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì™€ í¼í¬ë¨¼ìŠ¤ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ê°’ë“¤ì„ í™œìš©í•˜ì—¬ ë©”íŠ¸ë¦­ ê°’ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
<p>ê³„ì‚° ë¡œì§ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#bf616a;">netIfceMetric</span><span>[</span><span style="color:#bf616a;">NetRxBytes</span><span>] = </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">cur</span><span>.</span><span style="color:#bf616a;">RxBytes</span><span>-</span><span style="color:#bf616a;">pre</span><span>.</span><span style="color:#bf616a;">RxBytes</span><span>) / </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">deltaCTimeInNano</span><span>) * </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Second</span><span>)
</span><span style="color:#bf616a;">netIfceMetric</span><span>[</span><span style="color:#bf616a;">NetTxBytes</span><span>] = </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">cur</span><span>.</span><span style="color:#bf616a;">TxBytes</span><span>-</span><span style="color:#bf616a;">pre</span><span>.</span><span style="color:#bf616a;">TxBytes</span><span>) / </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">deltaCTimeInNano</span><span>) * </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Second</span><span>)
</span></code></pre>
<p><a href="https://github.com/google/cadvisor/blob/648b12f8db47171ebd0fc45c67d53574ddb017fe/info/v1/container.go#L418-L437"><code>cur.RxBytes</code></a>ì˜ ë°ì´í„° íƒ€ì…ì´ <code>uint64</code>ì—¬ì„œ ì–¸ë”í”Œë¡œìš°ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ê³¼ë„í•œ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ê²½ìš°ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ëŠ” ë¶€ë¶„ì´ ìˆì—ˆê³ , ì‹¤ì œ ê°’ë„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#65737e;">// github.com/
</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">netIfceMetric</span><span>[</span><span style="color:#bf616a;">NetRxBytes</span><span>] &gt; </span><span style="color:#bf616a;">oneTerabytes </span><span>|| </span><span style="color:#bf616a;">netIfceMetric</span><span>[</span><span style="color:#bf616a;">NetTxBytes</span><span>] &gt; </span><span style="color:#bf616a;">oneTerabytes </span><span>{
</span><span>	</span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Printf</span><span>(&quot;</span><span style="color:#a3be8c;">I! Too Big value for network RX/TX bytes, final Rx:</span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">, final Tx:</span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">, curRx:</span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">, preRx:</span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">, curTx:</span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">, preTx:</span><span style="color:#d08770;">%v</span><span style="color:#a3be8c;">, deltaCTimeInNano:</span><span style="color:#d08770;">%v</span><span>&quot;,
</span><span>		</span><span style="color:#bf616a;">netIfceMetric</span><span>[</span><span style="color:#bf616a;">NetRxBytes</span><span>], </span><span style="color:#bf616a;">netIfceMetric</span><span>[</span><span style="color:#bf616a;">NetTxBytes</span><span>],
</span><span>		</span><span style="color:#bf616a;">cur</span><span>.</span><span style="color:#bf616a;">RxBytes</span><span>, </span><span style="color:#bf616a;">pre</span><span>.</span><span style="color:#bf616a;">RxBytes</span><span>,
</span><span>		</span><span style="color:#bf616a;">cur</span><span>.</span><span style="color:#bf616a;">TxBytes</span><span>, </span><span style="color:#bf616a;">pre</span><span>.</span><span style="color:#bf616a;">TxBytes</span><span>,
</span><span>		</span><span style="color:#bf616a;">deltaCTimeInNano</span><span>)
</span><span>}
</span></code></pre>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>2022-04-08T08:18:17Z I! Too Big value for network RX/TX bytes, final Rx:3.1837731352719405e+17, final Tx:3.183773135286772e+17, curRx:692608, preRx:317669466, curTx:11946450, preTx:242992298, deltaCTimeInNano:57939882302
</span></code></pre>
<p>Go Playgroundì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#65737e;">// https://play.golang.com/p/KppWhxtTtad
</span><span style="color:#b48ead;">package </span><span style="color:#bf616a;">main
</span><span>
</span><span style="color:#b48ead;">import </span><span>(
</span><span>	&quot;</span><span style="color:#a3be8c;">fmt</span><span>&quot;
</span><span>	&quot;</span><span style="color:#a3be8c;">time</span><span>&quot;
</span><span>)
</span><span>
</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>	</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">curRxBytes </span><span style="color:#b48ead;">uint64 </span><span>= </span><span style="color:#d08770;">692608 	
</span><span>	</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">preRxBytes </span><span style="color:#b48ead;">uint64 </span><span>= </span><span style="color:#d08770;">317669466
</span><span>	</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">deltaCTimeInNano </span><span style="color:#b48ead;">int64 </span><span>= </span><span style="color:#d08770;">57939882302
</span><span>	</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">rxBytes </span><span>= </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">curRxBytes</span><span>-</span><span style="color:#bf616a;">preRxBytes</span><span>) / </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">deltaCTimeInNano</span><span>) * </span><span style="color:#bf616a;">float64</span><span>(</span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Second</span><span>)
</span><span>	</span><span style="color:#bf616a;">fmt</span><span>.</span><span style="color:#bf616a;">Printf</span><span>(&quot;</span><span style="color:#d08770;">%v</span><span>&quot;, </span><span style="color:#bf616a;">rxBytes</span><span>)
</span><span>    </span><span style="color:#65737e;">// output = 3.1837731352719405e+17
</span><span>}
</span></code></pre>
<p><code>3.1837731352719405e+17</code> ì™€ ê°™ì€ ê°’ì„ ì–»ì„ ìˆ˜ ìˆê³ , ì´ ê°’ì„ Pythonì—ì„œ í™•ì¸í•˜ë©´ ì›ë˜ CloudWatch Container Insightì—ì„œ ë³¸ í˜íƒ€ë°”ì´íŠ¸ ê°’ì´ ë‚˜ì˜µë‹ˆë‹¤.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span>&gt;&gt;&gt; </span><span style="color:#bf616a;">int</span><span>(</span><span style="color:#d08770;">3.1837731352719405e+17</span><span>)
</span><span style="color:#d08770;">318377313527194048
</span><span>&gt;&gt;&gt; </span><span style="color:#bf616a;">int</span><span>(</span><span style="color:#d08770;">3.1837731352719405e+17</span><span>) // (</span><span style="color:#d08770;">1024 </span><span>** </span><span style="color:#d08770;">5</span><span>) </span><span style="color:#65737e;"># KB MB GB TB PB
</span><span style="color:#d08770;">282
</span></code></pre>
<p>cAdvisorëŠ” <code>/proc/&lt;pid&gt;/net/dev</code>ì—ì„œ í”„ë¡œì„¸ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ë©”íŠ¸ë¦­ë“¤ì„ ê°€ì ¸ì˜¤ëŠ”ë°, í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ë©´ì„œ ê°’ì´ ëˆ„ì ë˜ê³ , ì¬ì‹œì‘í•˜ë©´ ë‹¤ì‹œ 0ë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ Podë¥¼ ë‚´ë¦¬ê³  ë‹¤ì‹œ ì˜¬ë¦´ ë•Œ, ê°™ì€ ì»¨í…Œì´ë„ˆ ì´ë¦„ì˜ ê²½ìš° ì´ì „ ê°’ë³´ë‹¤ í˜„ì¬ ê°’ì´ ë” ì‘ì•„ì§€ë©´ì„œ ì–¸ë”í”Œë¡œìš° ë²„ê·¸ê°€ ë°œìƒí•œ ê²ƒìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<p>ì´ ë¬¸ì œì™€ ê´€ë ¨í•˜ì—¬ Helmì´ë‚˜ ë‹¤ë¥¸ ì˜ˆì œì—ì„œ Pod ì´ë¦„ì´ í•­ìƒ ë‹¤ë¥¸ ê²ƒê³¼ ê´€ë ¨ì´ ìˆëŠ”ì§€ëŠ” ì•„ì§ í™•ì‹¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ğŸ¤”</p>

  </main>
  <p>
        Tags:
          <a href="https://moreal.dev/tags/sabjil/">#ì‚½ì§ˆ</a>
          <a href="https://moreal.dev/tags/go/">#Go</a>
          <a href="https://moreal.dev/tags/eks/">#EKS</a>
          <a href="https://moreal.dev/tags/aws/">#AWS</a>
          <a href="https://moreal.dev/tags/beogeu/">#ë²„ê·¸</a>
  </p>
<footer>
</footer>
</body>
</html>
